<!doctype html>
<html lang="en" data-framework="backbonejs">
   <head>
      <meta charset="utf-8">
      <title>Prezi</title>
      <link rel="stylesheet" href="static/css/bootstrap.css" />
      <link rel="stylesheet" href="static/css/bootstrap-theme.css" />
      <link rel="stylesheet" href="static/css/backgrid.css" />
      <link rel="stylesheet" href="static/css/backgrid-paginator.css" />
      <link rel="stylesheet" href="static/css/backgrid-text-cell.css" />
   </head>
   <body>
      <div id="main">
      <div id="search-container"></div>
         <div class="container">
            <div class="row">
               <div class="col-md-12">
                  <div id="grid"></div>
                  <div id="paginator"></div>
               </div>
            </div>
         </div>
      <script id="search-tmpl" type="text/template">
        <input id="search" type="text" value="">
      </script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.3.3/backbone-min.js"></script>
      <script src="static/js/lib/backbone.paginator.js"></script>
      <script src="static/js/lib/backgrid.js"></script>
      <script src="static/js/lib/bootstrap.js"></script>
      <script src="static/js/lib/backgrid-paginator.js"></script>
      <script src="static/js/lib/backgrid-text-cell.js"></script>
      <script type="text/javascript">
         var Presentations = Backbone.PageableCollection.extend({
         
         url: "http://localhost:8092/v1/presentations",
         state: {
             pageSize: 10,
             sortKey: "createdAt",
             order: 1
         },
         
         queryParams: {
             totalPages: null,
             totalRecords: null,
             sortKey: "sort",
             pageSize: "numitems",
             currentPage: "index",
             sortKey: "sortby",
             order: "direction",
             directions: { "0": "asc", "1": "desc" },
             paginate: true,
             sort: true
         },
         
         parseState: function(resp, queryParams, state, options) {
             return {
                 totalRecords: resp.totalRecords
             };
         },
         
         parseRecords: function(resp, options) {
             return resp.results;
         },
         
         search : function(letters){
           if(letters == "") return this;
         
           this.fetch({ data: { filter: 'title_' + letters, paginate : true}});
         }
         });
         
         var presentations = new Presentations();
         
         var grid = new Backgrid.Grid({
         columns: [{ 
             name: "title",
             cell: "string",
             label: "Title",
             sortable: true,
             editable: false
         },
         { 
             name: "createdAt",
             label: "Created At",
             cell: "string",
             sortable: true,
             editable: false
         }],
         
         collection: presentations
         });
         
         var paginator = new Backgrid.Extension.Paginator({
         collection: presentations
         });
         
         var SearchView = Backbone.View.extend({
           events: {
           "keyup #search" : "search"
           },
           render: function(data) {
             $(this.el).html(this.template);
             return this;
             },
           initialize : function(){
             this.template = _.template($("#search-tmpl").html());
             this.collection.bind("reset", this.render, this);
             },
           search: function(e){
             var letters = $("#search").val();
             this.collection.search(letters);
             }
           });
         
         var search = new SearchView({ collection : presentations})
         
         $("#search-container").append(search.render().$el);
         $("#grid").append(grid.render().$el);
         $("#paginator").append(paginator.render().$el);
         
         presentations.fetch({
            reset: true
         });
      </script>>
   </body>
</html>
